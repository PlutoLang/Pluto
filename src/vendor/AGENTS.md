# Repository Guidelines - Generated by https://clara.md/ from faros-ai 

## Scope & Layout
- `src/vendor/` houses third-party bundles. Today it contains Soup under `Soup/` along with build helpers such as `build_lib.php` and `build_common.php`.
- Treat everything here as vendored: prefer upstream refreshes or cherry-picked patches over local refactors and keep licence artefacts intact.

## Update & Build Workflow
- Build Soup via `php src/vendor/Soup/build_lib.php <compiler>` or indirectly through `php scripts/compile.php clang`, which calls `build_soup()`.
- To pull a new upstream revision run `src/vendor/Soup/soup/_update.php <tag>` and capture the resulting diff in its own commit, then rebuild Pluto to confirm ABI compatibility.

## Patch Guidelines
- Follow Soup’s conventions (tabs, CamelCase types, header-heavy structure). Scope custom logic behind `#ifdef PLUTO_*` guards and reference upstream issues in comments where relevant.
- Keep patches minimal, isolating Pluto-specific behavior so the change can be forwarded upstream. Never rename or move vendor files; automation relies on canonical paths.

## Testing Expectations
- After modifying vendor code or build helpers run `php scripts/compile.php clang && php scripts/link_pluto.php clang`, then targeted network suites such as `src/pluto testes/events.lua`.
- For TLS/HTTP changes add or update regression coverage in `testes/pluto/` and validate Windows via a Mingw toolchain (`php scripts/link_shared.php mingw`).

## Change Checklist
- Record the exact upstream commit or release in the PR/changelog and sync any licence updates.
- Prefer rerunning `_update.php` over manual edits when possible and notify maintainers before bumping major Soup versions.

## Execution Principles
- Only touch `src/vendor/*` when acceptance explicitly targets vendor code; wire product behavior through core modules (`src/lhttplib.cpp`, etc.) rather than reworking vendored internals.
- Maintain header/implementation alignment and update Soup build scripts alongside code changes when symbols or files move.
- Produce clean unified diffs (`---/+++` with `@@`) without logs; keep whitespace stable to avoid accidental hunks.
- Use canonical, case-sensitive paths and avoid adding duplicate or `_modified` files that would break update tooling.
- If edits surface in Pluto, ensure the core counterpart is updated in tandem so both sides compile together.

## Frequent Failure Patterns
- Owner drift: fixes meant for vendor code landed in core (`scripts/`, `src/`). Confirm the target prefix before editing.
- Missing companion edits: build helpers and headers (e.g., `build_common.php`, `Soup/soup/*.hpp`) often change together—plan the complete list up front.
- Diff formatting issues: submissions without proper diff markers (`no diff markers found`) are rejected; regenerate the patch before resubmitting.
- Overshoot: avoid whitespace sweeps or opportunistic cleanups that introduce extra hunks beyond the requested change.
- Path mistakes: incorrect casing or renamed files break update scripts—use the exact upstream filenames every time.

## Quick Owner Map
- HTTP request plumbing that crosses the boundary lives in `src/vendor/Soup/soup/HttpRequestTask.{hpp,cpp}` and connects to Pluto via `src/lhttplib.cpp`.
