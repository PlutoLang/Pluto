# Repository Guidelines - Generated by https://clara.md/ from Faros AI

## Scope & Layout
- `src/` mirrors upstream Lua with paired `.cpp`/`.h` files; place new runtime modules beside peers and surface public API only through `lua.h`/`lua.hpp` and `luaconf.h` when absolutely required.
- Generated `.sun` jump-table files live here; edit the generator rather than hand-editing the tables.
- Vendor code remains in `src/vendor/`; keep it isolated from core changes.

## Build & Integration
- Rebuild the tree with `php scripts/compile.php clang` (or the compiler of choice) and `php scripts/link_pluto.php clang`; `make -j PLAT=linux` provides the GCC path.
- When adding translation units, update `scripts/common.php::for_each_obj()` and any `Makefile` or project lists if filenames diverge from the `l*.cpp` pattern.
- The `pluto` and `plutoc` binaries land back in `src/`; relocate them only if the toolchain scripts are updated accordingly.

## Coding Standards
- Follow the Lua house style: two-space indentation, braces on the same line as control statements, and trailing whitespace stripped.
- Public entry points use the `lua_`/`pluto_` prefixes; internal helpers start with the subsystem `l` prefix. Keep headers self-contained with guards that mirror the filename (`LAPI_H`).
- Prefer existing macros from `llimits.h`, reuse shared inline helpers, and update GC/VM comment blocks when changing those subsystems.

## Testing Expectations
- After meaningful edits run `php scripts/compile.php clang && php scripts/link_pluto.php clang` followed by `src/pluto testes/_driver.pluto`.
- Trigger focused suites when touching critical areas (e.g., `src/pluto testes/gc.lua` for GC, targeted coroutine cases, or `testes/bench/*.pluto` when performance may regress).

## Change Checklist
- Reflect new APIs in `lua.h`/`lua.hpp` and guard platform-specific changes within `luaconf.h`.
- Document subtle invariants at the top of the affected translation unit.
- Coordinate ABI-impacting changes with `plutoc` maintainers before merging.

## Execution Principles
- Identify the exact owner and layer before editing (lexer/parser in `llex.*`/`lparser.*`, codegen in `lcode.*`, VM in `lvm.cpp`, libraries in `l*.cpp`, core HTTP in `lhttplib.cpp`, etc.).
- Keep scope surgical: only the files and contiguous hunks needed for the fix; avoid drive-by cleanups, doc/test edits, or vendor touch unless explicitly requested.
- Maintain header/implementation parity and update build wiring (`Makefile`, Visual Studio projects, `scripts/common.php`) whenever symbols or files change.
- Respect existing platform guards/macros when introducing conditional behavior and mirror those guards in build/project files.
- Produce valid unified diffs (`---/+++` with `@@`) without logs; maintain surrounding context and original whitespace.
- Match acceptance-specified diagnostics exactly, including punctuation and casing.
- Use canonical, case-correct paths; never create duplicate or renamed files to house changes.
- Plan required hunks up front and confirm all acceptance/top-path locations are covered before finalizing.

## Owner Cheat Sheet
- HTTP client options & validation: `src/lhttplib.cpp`; propagate cross-boundary wiring through `src/vendor/Soup/soup/HttpRequestTask.{hpp,cpp}` when options cross into Soup.
- OS library behavior: `src/loslib.cpp`.
- Table APIs vs engine: high-level functions in `src/ltablib.cpp`; underlying mechanics in `src/ltable.cpp`/`src/ltable.h`.
- Lexer/parser/config: tokens in `src/llex.*`, grammar/state in `src/lparser.*`, feature toggles in `src/luaconf.h`.
- Runtime/VM execution: `src/lvm.cpp`; code generation in `src/lcode.*`.

## Frequent Failure Patterns
- Parser/lexer/header drift: when tokens or enums change, update both sides plus headers so signatures and counts stay aligned.
- Library vs engine confusion: keep user-facing helpers in the lib files and move data-structure work to the engine (`ltable.*`).
- Missing companion hunks: acceptance often expects paired edits within a file or across `.cpp`/`.h`; audit the entire region before submitting.
- Overshoot and whitespace churn: extra hunks, stray comment tweaks, or formatting changes routinely cause rejections.
- Diff formatting issues: submissions without proper unified diff markers (`no diff markers found`) are rejectedâ€”fix tooling before resubmitting.
- Diagnostics mismatches: user-facing error text must match gold exactly; include location info when required.
- Docs/tests/vendor overshoot: do not edit `README.md`, `testes/`, or `src/vendor/` unless explicitly part of the task.
