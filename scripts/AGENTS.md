# Repository Guidelines - Generated by https://clara.md/ from Faros AI

## Scope & Layout
- `scripts/` hosts the PHP build and packaging tooling (e.g., `compile.php`, `link_pluto.php`, `link_plutoc.php`, bundle scripts) plus shared helpers in `common.php`.
- New scripts should follow the existing pattern: stateless helpers at the top, orchestration at the bottom, and heavy reuse of shared utilities instead of duplicating logic.

## Core Commands
- `php scripts/compile.php clang` builds every `.cpp` in `src/` using compiler flags from `common.php`.
- `php scripts/link_pluto.php clang`, `link_plutoc.php`, and `link_shared.php` link the interpreter, bytecode compiler, and shared targets; binaries are written to `src/` alongside their sources.
- All scripts accept the compiler executable as the first argument followed by raw flag fragments; maintain these calling conventions when extending tooling.

## Style Guidelines
- Use PHP 8 features with tabs for indentation, lower_snake_case function names, and uppercase constants.
- Local logging should remain concise and machine-parsable; use `escapeshellarg` for external commands and prefer existing async helpers (`run_command_async`, `await_commands`).
- Avoid absolute paths—derive locations from `__DIR__` and shared helpers.

## Testing Expectations
- Lint modified scripts with `php -l` and perform a smoke build (`php scripts/compile.php clang && php scripts/link_pluto.php clang`).
- Exercise packaging flows (`bundle_deb.php`, `bundle_nupkg.php`) with dry-run flags when feasible and document artifact paths.
- Validate Windows/Mingw scenarios at least once when touching cross-platform logic.

## Change Checklist
- Update `common.php` when introducing shared switches or behaviors.
- Document new script entry points in the top-level `README.md` only when acceptance requires it.
- Keep binaries, paths, and logging formats consistent with downstream expectations.

## Execution Principles
- Confine build/packaging work to `scripts/` (plus explicitly named project files) rather than editing `src/` or vendor code.
- Centralize reusable behavior in `common.php` to prevent drift between scripts.
- Produce minimal unified diffs (`---/+++` with `@@`), preserving existing whitespace to avoid accidental extra hunks.
- Escape all shell arguments, respect current working directory assumptions, and avoid hardcoded absolute paths unless a flag can override them.
- When script outputs change, update dependent project files (`Makefile`, `.vcxproj`, etc.) in the same patch so CI remains in sync.

## Frequent Failure Patterns
- Overshoot into docs/tests: README or `testes/` edits were rejected when the task only required script changes.
- Extra hunks in `common.php`: iterative rewrites added unrelated formatting changes—keep patches surgical and contiguous.
- Project wiring gaps: updates to file lists or outputs must be reflected in `Makefile`, `.vcxproj`, and related filters.
- Diff generation issues: patches without proper diff markers (`no diff markers found`) fail; regenerate before submitting.
- Config vs build drift: feature toggles belong in `luaconf.h` or existing config points—avoid encoding them directly in scripts unless acceptance demands it.
